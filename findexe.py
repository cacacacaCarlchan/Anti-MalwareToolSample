#!/usr/bin/env python3
# -*- coding: utf-8 -*-
# Author: Carl Sun
# Email: Yelisavita@163.com

import os,shutil
import hashlib
import csv

rootdir='C:\WINDOWS'
newpath='C:\exes'
list1=os.listdir(rootdir)
lista=list1[0:50]
#print(lista)

def join_path(l1):
      return os.path.join(rootdir,l1)
def is_file(x):
   return os.path.isfile(x)
def is_exe(x):
   return x.endswith('.exe')
def is_dir(x):
   return os.path.isdir(x)
def copy_file(l2):
   return shutil.copy(l2,newpath)
def merge_list(x1,x2,x3):
   global file_hash_list
   file_hash_list=list(zip(list(zip(x1,x2)),x3))
   return file_hash_list
def csv_write(x):
   f=open('C:\md5_SHA256.csv','w',encoding='utf-8')
   csv_writer=csv.writer(f)
   csv_writer.writerow(["file_name","md5","SHA256"])
   for row in x:
        csv_writer.writerow(row)
   


file_list=[]
dir_list=[]
file_hash_list=[]


def fun(x):
  
  path_list1=list(map(join_path,x))
  #print(path_list1)
  list_filt=list(filter(is_file,path_list1))
  global file_list
  file_list.extend(list_filt)
  #print(file_list)
  
  global dir_list
  dir_list.extend(list(filter(is_dir,path_list1)))
  #print(dir_list)

  if(len(dir_list)):
    list2=os.listdir(dir_list[0])
    global rootdir
    rootdir=dir_list.pop(0)
    #print(list2)
    return fun(list2)
  else:
    return file_list

def get_md5(x):
   file=open(x,'rb')
   return hashlib.md5(file.read()).hexdigest()
def get_SHA256(x):
   file=open(x,'rb')
   return hashlib.sha256(file.read()).hexdigest()

def main():
   file_list_final=fun(lista)
   #print(file_list_final)
   list_exe=list(filter(is_exe,file_list_final))[0:100]
   #print(list_exe)
   list_copy=list(map(copy_file,list_exe))
   list_md5=list(map(get_md5,list_exe))
   #print(list_md5)
   list_SHA256=list(map(get_SHA256,list_exe))
   #print(list_SHA256)
   merge_list(list_exe,list_md5,list_SHA256)
   csv_write(file_hash_list)



  


if __name__ == "__main__":
    main()

